<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | –≠–∫–æ–ª–æ–≥–∏—è –ë–µ–ª–∞—Ä—É—Å–∏</title>
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
      font-family: 'Manrope', sans-serif;
    }
    
    .admin-container {
      max-width: 1400px;
      margin: 50px auto;
      padding: 2rem;
    }
    
    .admin-header {
      background: linear-gradient(135deg, #1a3d2e, #2d6a4f);
      color: white;
      padding: 2rem;
      border-radius: 20px;
      margin-bottom: 2rem;
    }
    
    .admin-header h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      margin: 0 0 0.5rem 0;
    }
    
    .filters-bar {
      background: white;
      padding: 1.5rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      display: flex;
      gap: 1rem;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .filter-label {
      font-weight: 600;
      color: #1a3d2e;
    }
    
    .filter-select {
      padding: 0.5rem 1rem;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: border-color 0.3s;
    }
    
    .filter-select:focus {
      outline: none;
      border-color: #52b788;
    }
    
    .idea-admin-card {
      background: white;
      padding: 2rem;
      margin-bottom: 1.5rem;
      border-radius: 20px;
      box-shadow: 0 2px 20px rgba(26, 61, 46, 0.08);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .idea-admin-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 30px rgba(26, 61, 46, 0.12);
    }
    
    .idea-header-admin {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
    }
    
    .idea-meta {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: #f8f9fa;
      border-radius: 8px;
      font-size: 0.9rem;
    }
    
    .status-badge {
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .status-–Ω–æ–≤–∞—è { background: #e3f2fd; color: #1976d2; }
    .status-–Ω–∞-—Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ { background: #fff3e0; color: #f57c00; }
    .status-–æ–¥–æ–±—Ä–µ–Ω–∞ { background: #e8f5e9; color: #388e3c; }
    .status-–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞ { background: #ffebee; color: #d32f2f; }
    .status-—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ { background: #f3e5f5; color: #7b1fa2; }
    
    .admin-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 2px solid #f0f0f0;
    }
    
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-approve {
      background: linear-gradient(135deg, #52b788, #95d5b2);
      color: white;
    }
    
    .btn-reject {
      background: linear-gradient(135deg, #d64545, #e97451);
      color: white;
    }
    
    .btn-convert {
      background: linear-gradient(135deg, #4a7c9e, #74c0e3);
      color: white;
    }
    
    .btn-review {
      background: linear-gradient(135deg, #f59e0b, #fbbf24);
      color: white;
    }
    
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      background: white;
      border-radius: 20px;
      box-shadow: 0 2px 20px rgba(26, 61, 46, 0.08);
    }
    
    .empty-state h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      color: #1a3d2e;
      margin-bottom: 1rem;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      z-index: 10000;
      animation: slideIn 0.3s ease;
    }
    
    .notification.success {
      background: linear-gradient(135deg, #52b788, #95d5b2);
    }
    
    .notification.error {
      background: linear-gradient(135deg, #d64545, #e97451);
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .loading {
      text-align: center;
      padding: 3rem;
      font-size: 1.2rem;
      color: #52b788;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <div class="admin-header">
      <h1>üõ°Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
      <p style="margin: 0; opacity: 0.9;">–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏–¥–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
    </div>
    
    <div class="filters-bar">
      <span class="filter-label">–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:</span>
      <select id="statusFilter" class="filter-select">
        <option value="">–í—Å–µ –∏–¥–µ–∏</option>
        <option value="–Ω–æ–≤–∞—è">–ù–æ–≤—ã–µ</option>
        <option value="–Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
        <option value="–æ–¥–æ–±—Ä–µ–Ω–∞">–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ</option>
        <option value="–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞">–û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ</option>
        <option value="—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞">–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ</option>
      </select>
      
      <span class="filter-label" style="margin-left: 2rem;">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
      <select id="sortFilter" class="filter-select">
        <option value="date">–ü–æ –¥–∞—Ç–µ</option>
        <option value="votes">–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
      </select>
    </div>
    
    <div id="ideasList">
      <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–¥–µ–π...</div>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script>
    let allIdeas = [];
    
    async function loadIdeas() {
      try {
        const response = await API.getIdeas({ sort: 'date', order: 'desc' });
        allIdeas = response;
        applyFilters();
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–¥–µ–π:', error);
        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–¥–µ–π', 'error');
      }
    }
    
    function applyFilters() {
      const statusFilter = document.getElementById('statusFilter').value;
      const sortFilter = document.getElementById('sortFilter').value;
      
      let filtered = [...allIdeas];
      
      // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
      if (statusFilter) {
        filtered = filtered.filter(idea => idea.status === statusFilter);
      }
      
      // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
      if (sortFilter === 'votes') {
        filtered.sort((a, b) => b.votes - a.votes);
      } else {
        filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      }
      
      renderIdeas(filtered);
    }
    
    function renderIdeas(ideas) {
      const container = document.getElementById('ideasList');
      
      if (ideas.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>üì≠ –ù–µ—Ç –∏–¥–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = ideas.map(idea => `
        <div class="idea-admin-card" data-id="${idea.id}">
          <div class="idea-header-admin">
            <div>
              <h3 style="font-family: 'Playfair Display', serif; font-size: 1.5rem; margin: 0 0 0.5rem 0; color: #1a3d2e;">
                ${idea.title}
              </h3>
              <div class="idea-meta">
                <span class="meta-item">üë§ ${idea.author_name}</span>
                <span class="meta-item">üìÅ ${idea.category}</span>
                <span class="meta-item">üëç ${idea.votes} –≥–æ–ª–æ—Å–æ–≤</span>
                <span class="meta-item">üìÖ ${formatDate(idea.created_at)}</span>
              </div>
            </div>
            <span class="status-badge status-${idea.status.replace(' ', '-')}">${idea.status}</span>
          </div>
          
          <p style="color: #555; line-height: 1.6; margin: 1rem 0;">${idea.description}</p>
          
          <div class="admin-actions">
            <button class="btn btn-review" onclick="updateStatus(${idea.id}, '–Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏')" 
                    ${idea.status === '–Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏' ? 'disabled' : ''}>
              <span>‚è≥</span> –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ
            </button>
            <button class="btn btn-approve" onclick="updateStatus(${idea.id}, '–æ–¥–æ–±—Ä–µ–Ω–∞')"
                    ${idea.status === '–æ–¥–æ–±—Ä–µ–Ω–∞' ? 'disabled' : ''}>
              <span>‚úÖ</span> –û–¥–æ–±—Ä–∏—Ç—å
            </button>
            <button class="btn btn-reject" onclick="updateStatus(${idea.id}, '–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞')"
                    ${idea.status === '–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞' ? 'disabled' : ''}>
              <span>‚ùå</span> –û—Ç–∫–ª–æ–Ω–∏—Ç—å
            </button>
            <button class="btn btn-convert" onclick="convertToProblem(${idea.id})">
              <span>üîÑ</span> –í –ø—Ä–æ–±–ª–µ–º—ã
            </button>
          </div>
        </div>
      `).join('');
    }
    
    async function updateStatus(ideaId, newStatus) {
      try {
        await API.updateIdea(ideaId, { status: newStatus });
        showNotification(`–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω –Ω–∞: ${newStatus}`, 'success');
        await loadIdeas(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞', 'error');
      }
    }
    
    async function convertToProblem(ideaId) {
      const idea = allIdeas.find(i => i.id === ideaId);
      if (!idea) return;
      
      const severity = prompt('–£—Ä–æ–≤–µ–Ω—å —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏ (–Ω–∏–∑–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–≤—ã—Å–æ–∫–∞—è/–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è):', '—Å—Ä–µ–¥–Ω—è—è');
      if (!severity) return;
      
      const validSeverities = ['–Ω–∏–∑–∫–∞—è', '—Å—Ä–µ–¥–Ω—è—è', '–≤—ã—Å–æ–∫–∞—è', '–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è'];
      if (!validSeverities.includes(severity)) {
        showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏', 'error');
        return;
      }
      
      try {
        // –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–±–ª–µ–º—É
        await API.createProblem({
          title: idea.title,
          description: idea.description,
          category: idea.category,
          severity: severity
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏–¥–µ–∏
        await updateStatus(ideaId, '—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞');
        
        showNotification('–ò–¥–µ—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∞ –≤ –ø—Ä–æ–±–ª–µ–º—É!', 'success');
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã', 'error');
      }
    }
    
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('ru-RU', {
        day: 'numeric',
        month: 'long',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => notification.remove(), 3000);
    }
    
    // –°–æ–±—ã—Ç–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
    document.getElementById('statusFilter').addEventListener('change', applyFilters);
    document.getElementById('sortFilter').addEventListener('change', applyFilters);
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadIdeas();
  </script>
</body>
</html>