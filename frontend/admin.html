<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | –≠–∫–æ–ª–æ–≥–∏—è –ë–µ–ª–∞—Ä—É—Å–∏</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .admin-container {
      max-width: 1200px;
      margin: 100px auto;
      padding: 2rem;
    }
    
    .idea-admin-card {
      background: white;
      padding: 2rem;
      margin-bottom: 1.5rem;
      border-radius: 20px;
      box-shadow: 0 2px 20px rgba(26, 61, 46, 0.08);
    }
    
    .admin-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .btn-approve {
      padding: 0.75rem 1.5rem;
      background: var(--meadow-green);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .btn-reject {
      padding: 0.75rem 1.5rem;
      background: var(--danger-red);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .btn-convert {
      padding: 0.75rem 1.5rem;
      background: var(--lake-blue);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <h1 style="font-family: var(--font-display); font-size: 2.5rem; margin-bottom: 2rem;">
      –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏–¥–µ–π
    </h1>
    
    <div id="ideasList"></div>
  </div>

  <script src="js/api.js"></script>
  <script>
    async function loadIdeas() {
      try {
        const ideas = await API.getIdeas({ sort: 'date', order: 'desc' });
        renderIdeas(ideas);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–¥–µ–π:', error);
      }
    }
    
    function renderIdeas(ideas) {
      const container = document.getElementById('ideasList');
      
      container.innerHTML = ideas.map(idea => `
        <div class="idea-admin-card">
          <h3>${idea.title}</h3>
          <p><strong>–ê–≤—Ç–æ—Ä:</strong> ${idea.author_name}</p>
          <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${idea.category}</p>
          <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${idea.description}</p>
          <p><strong>–ì–æ–ª–æ—Å–æ–≤:</strong> ${idea.votes}</p>
          <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${idea.status}</p>
          
          <div class="admin-actions">
            <button class="btn-approve" onclick="updateStatus(${idea.id}, '–æ–¥–æ–±—Ä–µ–Ω–∞')">
              ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
            </button>
            <button class="btn-reject" onclick="updateStatus(${idea.id}, '–æ—Ç–∫–ª–æ–Ω–µ–Ω–∞')">
              ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
            </button>
            <button class="btn-convert" onclick="convertToProblem(${idea.id})">
              üîÑ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–±–ª–µ–º—É
            </button>
          </div>
        </div>
      `).join('');
    }
    
    async function updateStatus(ideaId, newStatus) {
      try {
        await API.updateIdea(ideaId, { status: newStatus });
        alert(`–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω –Ω–∞: ${newStatus}`);
        loadIdeas();
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞');
      }
    }
    
    async function convertToProblem(ideaId) {
      const idea = await API.getIdeas().then(ideas => ideas.find(i => i.id === ideaId));
      
      if (!idea) return;
      
      const severity = prompt('–£—Ä–æ–≤–µ–Ω—å —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏ (–Ω–∏–∑–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–≤—ã—Å–æ–∫–∞—è/–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è):', '—Å—Ä–µ–¥–Ω—è—è');
      
      if (!severity) return;
      
      try {
        // –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–±–ª–µ–º—É
        const response = await fetch('${API_BASE_URL}/problems', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            title: idea.title,
            description: idea.description,
            category: idea.category,
            severity: severity
          })
        });
        
        if (response.ok) {
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏–¥–µ–∏
          await updateStatus(ideaId, '—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞');
          alert('–ò–¥–µ—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∞ –≤ –ø—Ä–æ–±–ª–µ–º—É!');
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã');
      }
    }
    
    loadIdeas();
  </script>
</body>
</html>