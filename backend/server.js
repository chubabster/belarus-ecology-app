// server.js
// –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–± —ç–∫–æ–ª–æ–≥–∏–∏ –ë–µ–ª–∞—Ä—É—Å–∏

const express = require('express');
const cors = require('cors');
const bodyParser = require('body-parser');
const fs = require('fs');
const path = require('path');

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware
app.use(cors());
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));

// –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
async function initDatabase() {
  const pool = require('./database/config');
  
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ç–∞–±–ª–∏—Ü—ã
    const checkTables = await pool.query(`
      SELECT EXISTS (
        SELECT FROM information_schema.tables 
        WHERE table_schema = 'public' 
        AND table_name = 'problems'
      );
    `);
    
    const tablesExist = checkTables.rows[0].exists;
    
    if (!tablesExist) {
      console.log('üì¶ –¢–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...');
      
      // –ß–∏—Ç–∞–µ–º SQL —Ñ–∞–π–ª —Å –ø—É—Å—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
      const sqlPath = path.join(__dirname, 'database', 'init_empty.sql');
      const sql = fs.readFileSync(sqlPath, 'utf8');
      
      // –í—ã–ø–æ–ª–Ω—è–µ–º SQL
      await pool.query(sql);
      
      console.log('‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã!');
      
      // –¢–µ–ø–µ—Ä—å –∑–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
      await seedDatabase(pool);
    } else {
      console.log('‚úÖ –¢–∞–±–ª–∏—Ü—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ problems
      const checkData = await pool.query('SELECT COUNT(*) FROM problems');
      const problemsCount = parseInt(checkData.rows[0].count);
      
      if (problemsCount === 0) {
        console.log('üì¶ –¢–∞–±–ª–∏—Ü—ã –ø—É—Å—Ç—ã–µ, –∑–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä–∞–º–∏...');
        await seedDatabase(pool);
      } else {
        console.log(`‚úÖ –í –ë–î —É–∂–µ –µ—Å—Ç—å ${problemsCount} –ø—Ä–æ–±–ª–µ–º, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ`);
      }
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î:', error.message);
    // –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Ä–≤–µ—Ä, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
  }
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
async function seedDatabase(pool) {
  try {
    console.log('üå± –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î –ø—Ä–∏–º–µ—Ä–∞–º–∏...');
    
    // –í—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º—ã
    const problemsData = [
      ['–ó–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –≤–æ–¥–æ—ë–º–æ–≤', '–†–µ–∫–∏ –∏ –æ–∑—ë—Ä–∞ –ë–µ–ª–∞—Ä—É—Å–∏ —Å—Ç—Ä–∞–¥–∞—é—Ç –æ—Ç –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –∏ –±—ã—Ç–æ–≤—ã—Ö —Å—Ç–æ—á–Ω—ã—Ö –≤–æ–¥. –û—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã —Ä–µ–∫–∏ –î–Ω–µ–ø—Ä, –ü—Ä–∏–ø—è—Ç—å –∏ –ó–∞–ø–∞–¥–Ω–∞—è –î–≤–∏–Ω–∞. –ó–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –ø–∏—Ç—å–µ–≤–æ–π –≤–æ–¥—ã –∏ –±–∏–æ—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ.', '–í–æ–¥–∞', '–≤—ã—Å–æ–∫–∞—è'],
      ['–í—ã—Ä—É–±–∫–∞ –ª–µ—Å–æ–≤', '–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –ë–µ–ª–∞—Ä—É—Å—å ‚Äî –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö –ª–µ—Å–∏—Å—Ç—ã—Ö —Å—Ç—Ä–∞–Ω –ï–≤—Ä–æ–ø—ã, –Ω–µ—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤—ã—Ä—É–±–∫–∞ –ª–µ—Å–æ–≤ —É–≥—Ä–æ–∂–∞–µ—Ç —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞–º. –û—Å–æ–±–µ–Ω–Ω–æ —Å—Ç—Ä–∞–¥–∞—é—Ç –ø–æ–π–º–µ–Ω–Ω—ã–µ –ª–µ—Å–∞ –∏ –æ—Å–æ–±–æ –æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏.', '–õ–µ—Å–∞', '—Å—Ä–µ–¥–Ω—è—è'],
      ['–ó–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞ –≤ –≥–æ—Ä–æ–¥–∞—Ö', '–í—ã–±—Ä–æ—Å—ã –æ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π —Å–æ–∑–¥–∞—é—Ç —Å–º–æ–≥ –≤ –∫—Ä—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö: –ú–∏–Ω—Å–∫–µ, –ì–æ–º–µ–ª–µ, –í–∏—Ç–µ–±—Å–∫–µ. –≠—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞—Å–µ–ª–µ–Ω–∏—è.', '–í–æ–∑–¥—É—Ö', '–≤—ã—Å–æ–∫–∞—è'],
      ['–ü—Ä–æ–±–ª–µ–º–∞ –æ—Ç—Ö–æ–¥–æ–≤ –∏ –º—É—Å–æ—Ä–∞', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Ö–æ–¥–æ–≤ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—é –ø–æ–ª–∏–≥–æ–Ω–æ–≤. –õ–∏—à—å 20% –º—É—Å–æ—Ä–∞ –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ —Å–≤–∞–ª–∫–∏.', '–û—Ç—Ö–æ–¥—ã', '–≤—ã—Å–æ–∫–∞—è'],
      ['–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã –Ω–∞ –ß–ê–≠–°', '–û–∫–æ–ª–æ 23% —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –ë–µ–ª–∞—Ä—É—Å–∏ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω—ã —Ä–∞–¥–∏–æ–Ω—É–∫–ª–∏–¥–∞–º–∏. –≠—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –∑–¥–æ—Ä–æ–≤—å–µ –ª—é–¥–µ–π, —Å–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ –∏ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã.', '–†–∞–¥–∏–∞—Ü–∏—è', '–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è'],
      ['–ò—Å—Ç–æ—â–µ–Ω–∏–µ —Ç–æ—Ä—Ñ—è–Ω–∏–∫–æ–≤', '–û—Å—É—à–µ–Ω–∏–µ –∏ –¥–æ–±—ã—á–∞ —Ç–æ—Ä—Ñ–∞ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –±–æ–ª–æ—Ç, –∫–æ—Ç–æ—Ä—ã–µ –∏–≥—Ä–∞—é—Ç –≤–∞–∂–Ω—É—é —Ä–æ–ª—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–∏ –≤–æ–¥–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ —É–≥–ª–µ—Ä–æ–¥–∞.', '–ü–æ—á–≤–∞', '—Å—Ä–µ–¥–Ω—è—è']
    ];
    
    for (const [title, description, category, severity] of problemsData) {
      await pool.query(
        'INSERT INTO problems (title, description, category, severity) VALUES ($1, $2, $3, $4)',
        [title, description, category, severity]
      );
    }
    
    console.log('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ 6 –ø—Ä–æ–±–ª–µ–º');
    
    // –í—Å—Ç–∞–≤–ª—è–µ–º —Ä–µ—à–µ–Ω–∏—è
    const solutionsData = [
      // –†–µ—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º—ã 1 (–í–æ–¥–∞)
      [1, '–£—á–∞—Å—Ç–∏–µ –≤ –æ—á–∏—Å—Ç–∫–µ –≤–æ–¥–æ—ë–º–æ–≤', '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –≤–æ–ª–æ–Ω—Ç—ë—Ä—Å–∫–∏–º –∞–∫—Ü–∏—è–º –ø–æ –æ—á–∏—Å—Ç–∫–µ –±–µ—Ä–µ–≥–æ–≤ —Ä–µ–∫ –∏ –æ–∑—ë—Ä. –£–±–∏—Ä–∞–π—Ç–µ –º—É—Å–æ—Ä, –Ω–µ –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –æ—Ç—Ö–æ–¥—ã –ø–æ—Å–ª–µ –ø–∏–∫–Ω–∏–∫–æ–≤.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '–ª–µ–≥–∫–æ', '—Å—Ä–µ–¥–Ω–∏–π'],
      [1, '–≠–∫–æ–Ω–æ–º–∏—è –≤–æ–¥—ã –¥–æ–º–∞', '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —ç–∫–æ–Ω–æ–º–Ω—ã–µ —Å–º–µ—Å–∏—Ç–µ–ª–∏ –∏ –±–∞—á–∫–∏ —É–Ω–∏—Ç–∞–∑–æ–≤. –ù–µ —Å–ª–∏–≤–∞–π—Ç–µ —Ö–∏–º–∏–∫–∞—Ç—ã –≤ –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—é.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '–ª–µ–≥–∫–æ', '–Ω–∏–∑–∫–∏–π'],
      [1, '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤', '–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ –ø–µ—Ç–∏—Ü–∏–∏ –∑–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –æ—á–∏—Å—Ç–Ω—ã—Ö —Å–æ–æ—Ä—É–∂–µ–Ω–∏–π –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –≤—ã–±—Ä–æ—Å–æ–≤.', '–æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π', '–ª–µ–≥–∫–æ', '–≤—ã—Å–æ–∫–∏–π'],
      
      // –†–µ—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º—ã 2 (–õ–µ—Å–∞)
      [2, '–ü–æ—Å–∞–¥–∫–∞ –¥–µ—Ä–µ–≤—å–µ–≤', '–£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –∞–∫—Ü–∏—è—Ö –ø–æ –ø–æ—Å–∞–¥–∫–µ –¥–µ—Ä–µ–≤—å–µ–≤. –ö–∞–∂–¥–æ–µ –¥–µ—Ä–µ–≤–æ ‚Äî –≤–∫–ª–∞–¥ –≤ –±—É–¥—É—â–µ–µ.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '–ª–µ–≥–∫–æ', '—Å—Ä–µ–¥–Ω–∏–π'],
      [2, '–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –±—É–º–∞–≥–∏', '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω—É—é –±—É–º–∞–≥—É, –ø–µ—á–∞—Ç–∞–π—Ç–µ —Å –¥–≤—É—Ö —Å—Ç–æ—Ä–æ–Ω, –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '–ª–µ–≥–∫–æ', '–Ω–∏–∑–∫–∏–π'],
      [2, '–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã—Ö –≤—ã—Ä—É–±–æ–∫', '–°–æ–æ–±—â–∞–π—Ç–µ –æ –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã—Ö –≤—ã—Ä—É–±–∫–∞—Ö –≤ –ø—Ä–∏—Ä–æ–¥–æ–æ—Ö—Ä–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –æ—Ä–≥–∞–Ω—ã –≤–ª–∞—Å—Ç–∏.', '–æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π', '—Å—Ä–µ–¥–Ω–µ', '–≤—ã—Å–æ–∫–∏–π'],
      
      // –†–µ—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º—ã 3 (–í–æ–∑–¥—É—Ö)
      [3, '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞', '–û—Ç–∫–∞–∂–∏—Ç–µ—Å—å –æ—Ç –ª–∏—á–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –≤ –ø–æ–ª—å–∑—É –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞, –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞ –∏–ª–∏ –ø–µ—à–∏—Ö –ø—Ä–æ–≥—É–ª–æ–∫.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '—Å—Ä–µ–¥–Ω–µ', '—Å—Ä–µ–¥–Ω–∏–π'],
      [3, '–û–∑–µ–ª–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∫–æ–Ω–æ–≤ –∏ –¥–≤–æ—Ä–æ–≤', '–í—ã—Ä–∞—â–∏–≤–∞–π—Ç–µ —Ä–∞—Å—Ç–µ–Ω–∏—è –Ω–∞ –±–∞–ª–∫–æ–Ω–∞—Ö –∏ –≤ –¥–≤–æ—Ä–∞—Ö ‚Äî –æ–Ω–∏ –æ—á–∏—â–∞—é—Ç –≤–æ–∑–¥—É—Ö.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '–ª–µ–≥–∫–æ', '–Ω–∏–∑–∫–∏–π'],
      [3, '–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞', '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é —ç–ª–µ–∫—Ç—Ä–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏ –≤–µ–ª–æ–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –≥–æ—Ä–æ–¥–∞—Ö.', '–æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π', '—Å—Ä–µ–¥–Ω–µ', '–≤—ã—Å–æ–∫–∏–π'],
      
      // –†–µ—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º—ã 4 (–û—Ç—Ö–æ–¥—ã)
      [4, '–†–∞–∑–¥–µ–ª—å–Ω—ã–π —Å–±–æ—Ä –º—É—Å–æ—Ä–∞', '–°–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ—Ç—Ö–æ–¥—ã: –±—É–º–∞–≥—É, –ø–ª–∞—Å—Ç–∏–∫, —Å—Ç–µ–∫–ª–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '–ª–µ–≥–∫–æ', '–≤—ã—Å–æ–∫–∏–π'],
      [4, '–û—Ç–∫–∞–∑ –æ—Ç –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –ø–ª–∞—Å—Ç–∏–∫–∞', '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—ã–µ —Å—É–º–∫–∏, –±—É—Ç—ã–ª–∫–∏ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã. –û—Ç–∫–∞–∂–∏—Ç–µ—Å—å –æ—Ç –ø–ª–∞—Å—Ç–∏–∫–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –∏ —Ç—Ä—É–±–æ—á–µ–∫.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '–ª–µ–≥–∫–æ', '—Å—Ä–µ–¥–Ω–∏–π'],
      [4, '–ö–æ–º–ø–æ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∫–∏', '–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–ø–æ—Å—Ç–Ω—É—é —è–º—É –¥–ª—è –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏—Ö –æ—Ç—Ö–æ–¥–æ–≤ –Ω–∞ –¥–∞—á–µ –∏–ª–∏ –≤ —á–∞—Å—Ç–Ω–æ–º –¥–æ–º–µ.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '—Å—Ä–µ–¥–Ω–µ', '—Å—Ä–µ–¥–Ω–∏–π'],
      
      // –†–µ—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º—ã 5 (–ß–ê–≠–°)
      [5, '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤', '–ü–æ–∫—É–ø–∞–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —á–∏—Å—Ç—ã—Ö —Ä–∞–π–æ–Ω–æ–≤ –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏—Ö –æ–±–ª–∞—Å—Ç–µ–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –º–µ—Å—Ç–Ω—ã–µ —Ñ–µ—Ä–º–µ—Ä—Å–∫–∏–µ —Ö–æ–∑—è–π—Å—Ç–≤–∞.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '–ª–µ–≥–∫–æ', '–Ω–∏–∑–∫–∏–π'],
      [5, '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ', '–ò–∑—É—á–∞–π—Ç–µ –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –≤ –∑–∞–≥—Ä—è–∑–Ω—ë–Ω–Ω—ã—Ö —Ä–∞–π–æ–Ω–∞—Ö.', '–æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π', '–ª–µ–≥–∫–æ', '—Å—Ä–µ–¥–Ω–∏–π'],
      
      // –†–µ—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º—ã 6 (–¢–æ—Ä—Ñ—è–Ω–∏–∫–∏)
      [6, '–û—Ç–∫–∞–∑ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ—Ä—Ñ–∞', '–í —Å–∞–¥–æ–≤–æ–¥—Å—Ç–≤–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã —Ç–æ—Ä—Ñ—É: –∫–æ–º–ø–æ—Å—Ç, –∫–æ–∫–æ—Å–æ–≤–æ–µ –≤–æ–ª–æ–∫–Ω–æ.', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π', '–ª–µ–≥–∫–æ', '—Å—Ä–µ–¥–Ω–∏–π'],
      [6, '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±–æ–ª–æ—Ç', '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –æ—Å—É—à—ë–Ω–Ω—ã—Ö –±–æ–ª–æ—Ç –∏ —Ç–æ—Ä—Ñ—è–Ω–∏–∫–æ–≤.', '–æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π', '—Å—Ä–µ–¥–Ω–µ', '–≤—ã—Å–æ–∫–∏–π']
    ];
    
    for (const [problem_id, title, description, level, difficulty, impact] of solutionsData) {
      await pool.query(
        'INSERT INTO solutions (problem_id, title, description, level, difficulty, impact) VALUES ($1, $2, $3, $4, $5, $6)',
        [problem_id, title, description, level, difficulty, impact]
      );
    }
    
    console.log('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ 16 —Ä–µ—à–µ–Ω–∏–π');
    console.log('üéâ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –ø—Ä–∏–º–µ—Ä–∞–º–∏!');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î:', error.message);
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
initDatabase();

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–æ–≤
const problemsRouter = require('./routes/problems');
const solutionsRouter = require('./routes/solutions');
const ideasRouter = require('./routes/ideas');

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–æ–≤
app.use('/api/problems', problemsRouter);
app.use('/api/solutions', solutionsRouter);
app.use('/api/ideas', ideasRouter);

// –ö–æ—Ä–Ω–µ–≤–æ–π –º–∞—Ä—à—Ä—É—Ç
app.get('/', (req, res) => {
  res.json({
    message: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ API —ç–∫–æ–ª–æ–≥–∏–∏ –ë–µ–ª–∞—Ä—É—Å–∏',
    version: '1.0.0',
    endpoints: {
      problems: '/api/problems',
      solutions: '/api/solutions',
      ideas: '/api/ideas'
    }
  });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ 404
app.use((req, res) => {
  res.status(404).json({ error: '–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' });
});

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({ 
    error: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',
    message: err.message 
  });
});

// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
app.listen(PORT, () => {
  console.log(`üåç –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É ${PORT}`);
  console.log(`üì° API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:${PORT}`);
});

module.exports = app;