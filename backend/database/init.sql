-- database/init.sql
-- Скрипт инициализации базы данных для приложения об экологии Беларуси

-- Создание базы данных (выполнить отдельно от основного скрипта)
-- CREATE DATABASE belarus_ecology;

-- Подключиться к базе данных belarus_ecology

-- Удаление таблиц если они существуют (для чистой установки)
DROP TABLE IF EXISTS ideas CASCADE;
DROP TABLE IF EXISTS problems CASCADE;
DROP TABLE IF EXISTS solutions CASCADE;

-- Таблица экологических проблем
CREATE TABLE problems (
  id SERIAL PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  description TEXT NOT NULL,
  category VARCHAR(100) NOT NULL,
  severity VARCHAR(50) NOT NULL,
  image_url TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Таблица решений проблем
CREATE TABLE solutions (
  id SERIAL PRIMARY KEY,
  problem_id INTEGER REFERENCES problems(id) ON DELETE CASCADE,
  title VARCHAR(255) NOT NULL,
  description TEXT NOT NULL,
  level VARCHAR(100) NOT NULL, -- индивидуальный, общественный, государственный
  difficulty VARCHAR(50) NOT NULL,
  impact VARCHAR(50) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Таблица идей пользователей
CREATE TABLE ideas (
  id SERIAL PRIMARY KEY,
  author_name VARCHAR(100) NOT NULL,
  title VARCHAR(255) NOT NULL,
  description TEXT NOT NULL,
  category VARCHAR(100) NOT NULL,
  votes INTEGER DEFAULT 0,
  status VARCHAR(50) DEFAULT 'новая',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Вставка данных о проблемах
INSERT INTO problems (title, description, category, severity, image_url) VALUES
('Загрязнение водоёмов', 'Реки и озёра Беларуси страдают от промышленных и бытовых сточных вод. Особенно проблемны реки Днепр, Припять и Западная Двина. Загрязнение влияет на качество питьевой воды и биоразнообразие.', 'Вода', 'высокая', 'water-pollution.jpg'),
('Вырубка лесов', 'Несмотря на то, что Беларусь — одна из самых лесистых стран Европы, нерациональная вырубка лесов угрожает экосистемам. Особенно страдают пойменные леса и особо охраняемые территории.', 'Леса', 'средняя', 'deforestation.jpg'),
('Загрязнение воздуха в городах', 'Выбросы от транспорта и промышленных предприятий создают смог в крупных городах: Минске, Гомеле, Витебске. Это влияет на здоровье населения.', 'Воздух', 'высокая', 'air-pollution.jpg'),
('Проблема отходов и мусора', 'Недостаточная культура переработки отходов приводит к переполнению полигонов. Лишь 20% мусора перерабатывается, остальное попадает на свалки.', 'Отходы', 'высокая', 'waste.jpg'),
('Последствия катастрофы на ЧАЭС', 'Около 23% территории Беларуси загрязнены радионуклидами. Это влияет на здоровье людей, сельское хозяйство и экосистемы.', 'Радиация', 'критическая', 'chernobyl.jpg'),
('Истощение торфяников', 'Осушение и добыча торфа приводят к деградации болот, которые играют важную роль в поддержании водного баланса и хранении углерода.', 'Почва', 'средняя', 'peatlands.jpg');

-- Вставка данных о решениях
INSERT INTO solutions (problem_id, title, description, level, difficulty, impact) VALUES
-- Решения для загрязнения водоёмов
(1, 'Участие в очистке водоёмов', 'Присоединяйтесь к волонтёрским акциям по очистке берегов рек и озёр. Убирайте мусор, не оставляйте отходы после пикников.', 'индивидуальный', 'легко', 'средний'),
(1, 'Экономия воды дома', 'Установите экономные смесители и бачки унитазов. Не сливайте химикаты в канализацию.', 'индивидуальный', 'легко', 'низкий'),
(1, 'Поддержка экологических инициатив', 'Подписывайте петиции за строительство очистных сооружений и контроль промышленных выбросов.', 'общественный', 'легко', 'высокий'),

-- Решения для вырубки лесов
(2, 'Посадка деревьев', 'Участвуйте в акциях по посадке деревьев. Каждое дерево — вклад в будущее.', 'индивидуальный', 'легко', 'средний'),
(2, 'Ответственное потребление бумаги', 'Используйте переработанную бумагу, печатайте с двух сторон, переходите на электронные документы.', 'индивидуальный', 'легко', 'низкий'),
(2, 'Контроль незаконных вырубок', 'Сообщайте о незаконных вырубках в природоохранные организации и органы власти.', 'общественный', 'средне', 'высокий'),

-- Решения для загрязнения воздуха
(3, 'Использование общественного транспорта', 'Откажитесь от личного автомобиля в пользу общественного транспорта, велосипеда или пеших прогулок.', 'индивидуальный', 'средне', 'средний'),
(3, 'Озеленение балконов и дворов', 'Выращивайте растения на балконах и в дворах — они очищают воздух.', 'индивидуальный', 'легко', 'низкий'),
(3, 'Продвижение электротранспорта', 'Поддерживайте инициативы по развитию электротранспорта и велоинфраструктуры в городах.', 'общественный', 'средне', 'высокий'),

-- Решения для проблемы отходов
(4, 'Раздельный сбор мусора', 'Сортируйте отходы: бумагу, пластик, стекло. Используйте специальные контейнеры для переработки.', 'индивидуальный', 'легко', 'высокий'),
(4, 'Отказ от одноразового пластика', 'Используйте многоразовые сумки, бутылки и контейнеры. Откажитесь от пластиковых пакетов и трубочек.', 'индивидуальный', 'легко', 'средний'),
(4, 'Компостирование органики', 'Создайте компостную яму для органических отходов на даче или в частном доме.', 'индивидуальный', 'средне', 'средний'),

-- Решения для последствий ЧАЭС
(5, 'Поддержка пострадавших регионов', 'Покупайте продукты из экологически чистых районов пострадавших областей, поддерживая местные фермерские хозяйства.', 'индивидуальный', 'легко', 'низкий'),
(5, 'Образование и информирование', 'Изучайте и распространяйте информацию о безопасном поведении в загрязнённых районах.', 'общественный', 'легко', 'средний'),

-- Решения для истощения торфяников
(6, 'Отказ от использования торфа', 'В садоводстве используйте альтернативы торфу: компост, кокосовое волокно.', 'индивидуальный', 'легко', 'средний'),
(6, 'Поддержка восстановления болот', 'Поддерживайте проекты по восстановлению осушённых болот и торфяников.', 'общественный', 'средне', 'высокий');

-- Создание индексов для улучшения производительности
CREATE INDEX idx_problems_category ON problems(category);
CREATE INDEX idx_solutions_problem_id ON solutions(problem_id);
CREATE INDEX idx_ideas_category ON ideas(category);
CREATE INDEX idx_ideas_created_at ON ideas(created_at DESC);
CREATE INDEX idx_ideas_votes ON ideas(votes DESC);

-- Комментарии к таблицам
COMMENT ON TABLE problems IS 'Таблица экологических проблем Беларуси';
COMMENT ON TABLE solutions IS 'Таблица решений экологических проблем';
COMMENT ON TABLE ideas IS 'Таблица идей пользователей по улучшению экологии';
